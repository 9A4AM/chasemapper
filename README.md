# Project Horus - Browser-Based HAB Chase Map

**Note: This is a work-in-progress. Not all of the features below are functional.**

This folder contains code to display payload (and chase car!) position data in a web browser:

![ChaseMapper Screenshot](https://github.com/projecthorus/chasemapper/raw/master/doc/chasemapper.jpg)

For this to run, you will need the horuslib library installed. Refer to the [Installation guide](https://github.com/projecthorus/horus_utils/wiki/1.-Dependencies-&-Installation).

You also need flask, and flask-socketio, which can be installed using pip:
```
$ sudo pip install flask flask-socketio
```

This is very much a work-in-progress, with much to be completed. For now, the following works:

To listen for payload data from OziMux (i.e. on UDP:localhost:8942):
```
$ python chasemapper.py --ozimux
```

To listen for payload data via the UDP broadcast 'Payload Summary' messages (which can be generated by OziMux, but also by [radiosonde_auto_rx](https://github.com/projecthorus/radiosonde_auto_rx/)):
```
$ python chasemapper.py --summary
```

The server can be stopped with CTRL+C.


## Live Predictions
kml_server can also run live predictions of the flight path. 

To do this you need cusf_predictor_wrapper and it's dependencies installed. Refer to the [documentation on how to install this](https://github.com/darksidelemm/cusf_predictor_wrapper/).
Once compiled and installed, you will need to: 
 * Copy the 'pred' binary into this directory. If using the Windows build, this will be `pred.exe`; under Linux/OSX, just `pred`.
 * [Download wind data](https://github.com/darksidelemm/cusf_predictor_wrapper/#3-getting-wind-data) for your area of interest, and place the .dat files into the gfs subdirectory. 

TODO: Update below doc. Most settings are set from the web interface.

The following additional arguments can then be used:

```
  --predict             Enable Flight Path Predictions.
  --predict_binary PREDICT_BINARY
                        Location of the CUSF predictor binary. Defaut = ./pred
  --burst_alt BURST_ALT
                        Expected Burst Altitude (m). Default = 30000
  --descent_rate DESCENT_RATE
                        Expected Descent Rate (m/s, positive value). Default =
                        5.0
  --abort               Enable 'Abort' Predictions.
  --predict_rate PREDICT_RATE
                        Run predictions every X seconds. Default = 15 seconds.
```

For example, to use kml_server to observe a typical radiosonde launch (using data emitted via the [payload summary messages](https://github.com/projecthorus/radiosonde_auto_rx/wiki/Configuration-Settings#payload-summary-output)), you would run:
```
$ python chasemapper.py --summary --predict --burst_alt=26000 --descent_rate=7.0
```


A few notes:
 * The ascent rate is calculated automatically, and is an average of the last 6 positions.
 * The 'Abort' prediction option is used to display a second prediction, which displays what would occur if the balloon burst *now*. This is useful for flights where you have a cutdown payload available, and want to know when to trigger it! This prediction disappears when the payload is either above the expected burst altitude, or is descending.